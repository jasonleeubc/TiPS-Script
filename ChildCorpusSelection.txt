function selectRows() {
  var sourceSheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName("parent corpus demographics");
  var destinationSheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName("child corpus");

  // Clear destination sheet before appending new data
  destinationSheet.clear();
  var sourceData = sourceSheet.getDataRange().getValues();

  // Shuffle the source data (excluding header)
  var shuffledData = shuffleArray(sourceData.slice(1));

  var selectedRows = [];
  var artistCount = {}; // Store count of values in column A (Artist names)
  var yearCount = {}; // Store count of values in column D (Year)
  var genderSum = 0; //
  var ethnicitySum = 0 ;//
  var genderTarget = 50 // DEFINE TARGET NUMBER OF NON-MALE ENTRIES HERE
  var ethnicityTarget = 42 // DEFINE TARGET NUMBER OF NON-WHITE ENTRIES HERE
  
  // Append header row to destination sheet
  selectedRows.push(sourceData[0]);

// Step 1: Iterate through the parent corpus to select rows with Agency = 1
  for (var i = 1; i < shuffledData.length; i++) { // Start from index 1 to skip header row
  var row = shuffledData[i];
  var agency = row[8]; // Assuming column I is the column for Agency
  var year = row[3]; // Assuming column D is the column for Year
  var artist = row[0]; // Assuming column A is the column for Artist
  var gender = row[4]; // Assuming column E is the column for Gender
  var ethnicity = row[7]; // Assuming column H is the column for Ethnicity

    // Select rows with positive value in the Agency column
    if (agency > 0) {
    // Check if counts exceed limits before adding the row
      if ((yearCount[year] < 10 || yearCount[year] === undefined) && (artistCount[artist] < 5 || artistCount[artist]===undefined) && genderSum < genderTarget && ethnicitySum < ethnicityTarget) {
        selectedRows.push(row);

        // Update counts for Year and Artist columns
        yearCount[year] = (yearCount[year] || 0) + 1;
        artistCount[artist] = (artistCount[artist] || 0) + 1;
        genderSum += gender;
        ethnicitySum += ethnicity;
      }
    }
  }

// Step 2: Iterate through the parent corpus to select minoritized (but with agency = 0) rows to complete the child corpus
  for (var j = 1; j < shuffledData.length; j++) { // Start from index 1 to skip header row
  var row = shuffledData[j];
  var agency = row[8]; // Assuming column I is the column for Agency
  var year = row[3]; // Assuming column D is the column for Year
  var artist = row[0]; // Assuming column A is the column for Artist
  var gender = row[4]; // Assuming column E is the column for Gender
  var ethnicity = row[7]; // Assuming column H is the column for Ethnicity

    // Select rows with positive value in the Agency column
    if ((agency == 0 && gender == 1) || (agency == 0 && ethnicity == 1)) {
    // Check if counts exceed limits before adding the row
      if ((yearCount[year] < 10 || yearCount[year] === undefined) && (artistCount[artist] < 5 || artistCount[artist]===undefined) && genderSum < genderTarget && ethnicitySum < ethnicityTarget) {
        selectedRows.push(row);

        // Update counts for Year and Artist columns
        yearCount[year] = (yearCount[year] || 0) + 1;
        artistCount[artist] = (artistCount[artist] || 0) + 1;
        genderSum += gender;
        ethnicitySum += ethnicity;
      }
    }
  }

// Step 3: Iterate through the parent corpus to select non-minoritized  rows to complete the child corpus
  for (var k = 1; k < shuffledData.length; k++) { // Start from index 1 to skip header row
  var row = shuffledData[k];
  var agency = row[8]; // Assuming column I is the column for Agency
  var year = row[3]; // Assuming column D is the column for Year
  var artist = row[0]; // Assuming column A is the column for Artist
  var gender = row[4]; // Assuming column E is the column for Gender
  var ethnicity = row[7]; // Assuming column H is the column for Ethnicity

    // Select rows with positive value in the Agency column
    if ((agency == 0 && gender == 0 && ethnicity == 0)) {
    // Check if counts exceed limits before adding the row
      if ((yearCount[year] < 10 || yearCount[year] === undefined) && (artistCount[artist] < 5 || artistCount[artist]===undefined)) {
        selectedRows.push(row);

        // Update counts for Year and Artist columns
        yearCount[year] = (yearCount[year] || 0) + 1;
        artistCount[artist] = (artistCount[artist] || 0) + 1;
      }
    }
  }

// Append selected rows to destination sheet
  for (var l = 0; l < selectedRows.length; l++) {
    destinationSheet.appendRow(selectedRows[l]);
  }



// Fisher-Yates shuffle algorithm
function shuffleArray(array) {
  for (var i = array.length - 1; i > 0; i--) {
    var j = Math.floor(Math.random() * (i + 1));
    var temp = array[i];
    array[i] = array[j];
    array[j] = temp;
  }
  return array;
}
}
